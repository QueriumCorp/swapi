#------------------------------------------------------------------------------
# written by: mcdaniel
# date:       sep-2022
#
# usage:      build a docker container for swapi development and push to aws ecr.
#------------------------------------------------------------------------------
name: Deploy SWAPI dev

on:
  workflow_dispatch:

jobs:
  deploy:
    # ´runs-on´ defines the operating environment for the 
    # Github action itself. This almost always should
    # be some version of ubuntu. If you're unsure then use
    # ubuntu-latest.
    # --------------------------------------------
    runs-on: ubuntu-latest
    env:
      AWS_REGION: us-east-2
      NAMESPACE: querium-swapi
      EKS_CLUSTER_NAME: stepwisemath-global-live
      ENVIRONMENT_ID: dev

    # deployment workflow begins here
    # --------------------------------------------
    steps:
      #------------------------------------------------------------------------
      # Initialize our Ubuntu environment using a common Action stored in this
      # repository
      #------------------------------------------------------------------------
      - name: Initialize environment
        uses: ./.github/actions/init
        with:
          aws-region: ${{ env.AWS_REGION }}
          k8s-namespace: ${{ env.NAMESPACE }}
          eks-cluster-name: ${{ env.EKS_CLUSTER_NAME }}

      # ---------------------------------------------------------------------------------
      # Deploy
      # ---------------------------------------------------------------------------------
      - name: Deploy to Kubernetes
        uses: ./.github/actions/deploy
        with:
          environment-id: ${{ env.ENVIRONMENT_ID }}
          namespace: ${{ env.NAMESPACE }}
